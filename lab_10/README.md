# Docker

**Задание:**
* Создать свой кастомный образ nginx на базе alpine. После запуска nginx должен отдавать кастомную страницу
* Определить разницу между контейнером и образом
* Ответить на вопрос: "Можно ли в контейнере собрать ядро?"

**NOTE:**
Собранный образ необходимо запушить в docker hub и дать ссылку на ваш
репозиторий.

## Создание custom образа nginx

### Dockerfile
```bash
# используем образ alpine как базовый
FROM alpine:3.18

# устанавливаем nginx
RUN apk add --no-cache nginx

# создаем директорию с index.html файлом 
RUN mkdir -p /var/www/html
RUN echo "Hello world!" > /var/www/html/index.html

# копируем настройки nginx для того, чтобы изменить путь к корневым файлу и папке
COPY default.conf /etc/nginx/http.d/default.conf

# в качестве стартового приложения указываем nginx с параметрами запуска в foreground 
ENTRYPOINT [ "nginx" ]
CMD ["-g", "daemon off;"]
```

Для старта контейнера используем следующую команду:
՝docker run --rm -ti -p 8080:80 --name otus-simple-nginx otus-simple-nginx՝
т.е. запускаем в интерактивном режиме, прокидываем порт 80 в 8080.

### Difference between container and image
Данный вопрос является очень расплывчатым, т.к. можно дать на него много ответов с разных сторон.

* `image` - это слой файлов с какими-то дополнительными аргументами, которые используются при запуске контейнера из этого image. 
* контейнер - это `image` + `runtime` информация (память + регистры и прочее) + слой файлов, которые генерируются рантайме.

Если отвечать относительно `fs`, то будут отличия в
* `/var/log`
* `/proc`
* `/var/run`
* скорее всего в других системных директориях, информация в которых пробрасывается с хоста (/dev, /sys)

### Publishing
* Создаем репозиторий на `dockerhub` -> `0rps/otus-simple-nginx`
* Выполняем `docker login`
* Выполняем ՝docker push 0rps/otus-simple-nginx:0.0.1՝

Получаем ссылку: [link](https://hub.docker.com/layers/0rps/otus-simple-nginx/0.0.1/images/sha256-1f3433844f2ed6bcf749056884e13343c494e8acada0aca4288b4b58f91bb2e3?context=explore)

## Ответ на вопрос "Можно ли в контейнере собрать ядро?"
Для начала необходимо понять, что нужно для сборки ядра
1. make/gcc и прочие утилиты для непосредственно проведения компиляции
2. исходный код, заголовки
3. конфигурационные файлы

Все эти вещи легко можно установить, добавит в докер образ. Поэтому ответ - **да**

Если говорить **о сборке модулей ядра**, то тут уже будет сложнее, т.к. модуль будет собираться для ядра хоста и дополнительные привилегии/пробросы папов будут необходимы, но опять же - **это возможно**.